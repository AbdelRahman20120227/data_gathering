<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <script src="jquery-3.3.1.min.js"></script>
        <style type="text/css">
        	body{
                font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",
                Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji"
                ,"Segoe UI Emoji","Segoe UI Symbol";
            }
        	.myDiv{
        		margin: 30px auto;
        		width: 600px;
        		border-radius: 10px;
        		border-color: red;
        		border-width: 3px;
        		border-style: solid;
        		padding: 30px;
        	}
        	textarea, button{
        		display: block;
        		width: 400px;
        		margin: 20px auto;
        	}
        	h1{
        		text-align: center;
                font-weight: bold;
        	}
            p{
                text-align: center;
                font-size: 20px;
                font-weight: bold;
            }
        	button{
        		background-color: rgb(71, 70, 70);
        		color: white;
        		border-style: none;
        		height: 30px;
        		font-weight: bold;
        		font-size: 15px;
                border-radius: 10px;
        	}
        	button:hover{
        		background-color:rgb(4, 133, 4);
        		color: white;
        	}
        	textarea{
        		border-color:black;
        	}
        	textarea:hover{
        		border-color: red;
        	}
        	
        </style>
        <script type="text/javascript">

			function getCookie(name) {
			    var nameEQ = name + "=";
			    var ca = document.cookie.split(';');
			    for(var i=0;i < ca.length;i++) {
			        var c = ca[i];
			        while (c.charAt(0)==' ') c = c.substring(1,c.length);
			        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
			    }
			    return null;
			}
        	$(window).on('load', function(){
                
                $("#welcome").text("Welcome " + getCookie("name") + ", Please answer the following\
                questions for the " + getCookie("role") + " role.");

                $.ajax({
                    type: 'get',
                    url: 'question?role=' + getCookie("role"),
                    success: (result)=>{
                        result.forEach(element => {
                            $("#questionsContainer").prepend("<p>" + element['text'] + "</p>\
                                <textarea id = '" + element['id'] + "'class = 'data' rows='10'></textarea>");
                        });
                    }
                });

                $("#submit").on('click', function(){
                    var answersData = {};
                    $(".data").toArray().forEach((element, i)=>{
                        answersData[$(element).attr('id')] = $(element).val(); 
                    });
                    $.ajax({
                        type: 'post',
                        url: 'answer',
                        data: {'data':JSON.stringify({'username': getCookie('name'), 'answers': answersData})},
                        success:(result)=>{
                            window.location = "Completion.html";
                        }
                    });
                    console.log(answersData);
                });

            });
        </script>
    </head>
    <body>
        <h1 id = 'welcome'></h1>
            
        <div class = "myDiv" id = "questionsContainer">
            <button id = "submit">Submit Test</button>
        </div>
    </body>

</html>
